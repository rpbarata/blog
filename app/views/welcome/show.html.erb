<div class="row">
    <h1 class="text-center" ><%= @article.title %></h1>
</div>
<br>
<div class="row">
    <%= image_tag @article.banner, class: "img-fluid" %>
</div>
<br>
<div class="row">
    <div class="justify_text">
        <%= @article.text %>
    </div>
</div>

<div class="text-right"> 
    <b><%= @article.user.username.present? ? @article.user.username : @article.user.email%></b>
    <% if @article.user.avatar.attached? %>
        <%= image_tag @article.user.avatar.variant(resize_to_limit: [50, 50]), class: "img-thumbnail" %>
    <% end %>
</div>

<a id="comments_sections"></a>
<h2>Comments (<%= @article.comments.size %>)</h2>
<% @article.comments.each do |comment| %>
    <div class="row">
        <div class="col-9">
            <div class="justify_text"><%= comment.body %></div>
        </div>
        <div class="col">
            <div class="row">
                <b><%= comment.user.username.present? ? comment.user.username : comment.user.email.split("@").first %></b>
                <%= image_tag comment.user.avatar.variant(resize_to_limit: [50, 50]), class: "img-thumbnail"  %>
            </div>
        </div>
    </div>

    <% if comment.reply_comments.any? %>
        <div class="container">
            <h5>Replies</h5>
            <% comment.reply_comments.each do |reply| %>
                <div class="row">
                    <div class="col-9">
                        <div class="justify_text"><%= reply.body %></div>
                    </div>
                    <div class="col">
                        <div class="row">
                            <b><%= reply.user.username.present? ? reply.user.username : reply.user.email.split("@").first %></b>
                            <%= image_tag reply.user.avatar.variant(resize_to_limit: [50, 50]), class: "img-thumbnail"  %>
                        </div>
                    </div>
                </div>
                <br>
            <% end %>
        </div>
    <% end %>
    <% if current_user %>
        <div class="container">
            <div class="row">
                <%= form_for [:users, @article, comment, comment.reply_comments.build], :namespace => comment.id do |new_reply_form| %>
                    <div class="col">
                        <%= new_reply_form.rich_text_area :body %>
                    </div>
                    <div class="col">
                        <%= new_reply_form.submit "Reply", class: "btn btn-primary" %>
                    </div>
                <% end %>
            </div>
        </div>
    <% end %>
    <hr>
<% end %>

<% if current_user %>
    <%= form_for([:users, @article, @article.comments.build]) do |new_comment_form| %>
        <div class="field">
            <%= new_comment_form.rich_text_area :body %>
        </div>

        <div class="row">
            <%= new_comment_form.submit "Comment", class: "btn btn-primary" %>
        </div>
    <% end %>
<% end %>